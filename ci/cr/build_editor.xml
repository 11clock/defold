<project name="de.vogella.build" default="build">
    <!--sets the path of the properties file-->
    <property file="build.properties" />

    <!-- For eclipse 3.7.2 -->
    <!-- property name="pdeBuildPluginVersion" value="3.7.0.v20111116-2009" />-->
    <!-- For eclipse 3.7.1 -->
    <property name="pdeBuildPluginVersion" value="3.7.0.v20110512-1320" />

    <property name="equinoxLauncherPluginVersion" value="1.2.0.v20110502" />
    <property name="eclipseLocation" value="${baseLocation}" />
    <property environment="env"/>

    <!-- NOTE: We skip clean. Ant *follows* symlinks - dangerous !
	 build.sh takes care of cleaning
      -->
    <target name="clean">
      <!-- <delete dir="${buildDirectory}" />-->
    </target>

    <target name="init">
        <exec dir="${buildDirectory}/plugins/com.dynamo.cr.common"
              executable="sh" failonerror="true">
              <arg value="scripts/build_proto.sh"/>
        </exec>

        <exec dir="${buildDirectory}/plugins/com.dynamo.cr.engine"
              executable="sh" failonerror="true">
              <arg value="scripts/copy_dmengine.sh"/>
        </exec>

        <exec dir="${buildDirectory}/plugins/com.dynamo.cr.parted"
              executable="sh" failonerror="true">
              <arg value="scripts/copy_libparticle.sh"/>
        </exec>

        <ant dir="${buildDirectory}/plugins/com.dynamo.cr.rlog" antfile="build_proto.xml"/>
        <ant dir="${buildDirectory}/plugins/com.dynamo.cr.common" antfile="build.xml"/>
        <ant dir="${buildDirectory}/plugins/com.dynamo.cr.builtins" antfile="build.xml"/>
        <ant dir="${buildDirectory}/plugins/com.dynamo.cr.luaeditor" antfile="build.xml"/>

    </target>


    <!--
        This target actually executes the PDE Build process by launching the
        Eclipse antRunner application.
    -->
    <target name="pde-build">
        <java classname="org.eclipse.equinox.launcher.Main" fork="true" failonerror="true">
            <arg value="-application" />
            <arg value="org.eclipse.ant.core.antRunner" />
            <arg value="-buildfile" />
            <arg value="${eclipseLocation}/plugins/org.eclipse.pde.build_${pdeBuildPluginVersion}/scripts/productBuild/productBuild.xml" />
            <arg value="-Dtimestamp=${timestamp}" />
            <arg value="-DbaseLocation=${baseLocation}" />
            <arg value="-DbuildDirectory=${buildDirectory}" />
            <arg value="-DbuildProperties=${buildProperties}" />
            <classpath>
                <pathelement location="${baseLocation}/plugins/org.eclipse.equinox.launcher_${equinoxLauncherPluginVersion}.jar" />
            </classpath>
        </java>
    </target>

    <!--This target defines the run-order of the targets-->
    <target name="build" depends="clean, init, pde-build" />
</project>
