import sys, os

import Task, TaskGen
from TaskGen import extension, declare_extension

sys.path.insert(0, "src")
import waf_gamesys

if sys.platform == "win32":
    os.environ["PYTHONPATH"] = os.environ["PYTHONPATH"] + ";default/proto;../src"
else:
    os.environ["PYTHONPATH"] = os.environ["PYTHONPATH"] + ":default/proto:../src"

def configure(conf):
    conf.find_file('meshc.py', [os.path.abspath('tools')], var = 'MESHC', mandatory = True)

def build(bld):
    dirs = [
            'camera',
            'collection_proxy',
            'collision_object',
            'convex_shape',
            'emitter',
            'font',
            'fragment_program',
            'gui',
            'input',
            'light',
            'material',
            'mesh',
            'model',
            'render',
            'render_script',
            'script',
            'sound',
            'spawn_point',
            'sprite',
            'texture',
            'vertex_program']
    exts = ['camera',
            'collisionobject',
            'convexshape',
            'emitter',
            'font',
            'fp',
            'gui',
            'gui_script',
            'gamepads',
            'input_binding',
            'jpg',
            'light',
            'material',
            'mesh',
            'model',
            'png',
            'render',
            'render_script',
            'script',
            'spawnpoint',
            'sprite',
            'vp',
            'wav']
    test_task_gen = bld.new_task_gen(features = 'cxx cprogram',
                                     includes = '../../../src ../../../proto %s' % (dir),
                                     uselib = 'GTEST GAMEOBJECT DDF RESOURCE GRAPHICS_UTIL DLIB PHYSICS RENDER GRAPHICS_NULL PLATFORM_SOCKET LUA SCRIPT INPUT HID_NULL PARTICLE GUI SOUND_NULL',
                                     uselib_local = 'gamesys',
                                     proto_gen_py = True,
                                     content_root='.',
                                     target = 'test_gamesys')
    test_task_gen.find_sources_in_dirs('. ' + ' '.join(dirs), exts)
    test_task_gen.install_path = None

    bld.add_subdirs('fontview')
