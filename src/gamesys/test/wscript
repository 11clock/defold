import Task, TaskGen
from TaskGen import extension

Task.simple_task_type('testresourcecont', 'protoc --encode=TestResource.ResourceContainerDesc -I ../src/gamesys/test ../src/gamesys/test/test_resource_ddf.proto < ${SRC} > ${TGT}',
                      color='PINK', 
                      before='cc cxx',
                      shell=True)

@extension('.cont_pb')
def testresourcecont_file(self, node):
    obj_ext = '.cont'
    task = self.create_task('testresourcecont')
    task.set_inputs(node)
    out = node.change_ext(obj_ext)
    task.set_outputs(out)

Task.simple_task_type('resourcefoo', 'protoc --encode=TestResource.ResourceFoo -I ../src/gamesys/test ../src/gamesys/test/test_resource_ddf.proto < ${SRC} > ${TGT}',
                      color='PINK', 
                      before='cc cxx',
                      shell=True)

@extension('.foo_pb')
def testresourcecont_file(self, node):
    obj_ext = '.foo'
    task = self.create_task('resourcefoo')
    task.set_inputs(node)
    out = node.change_ext(obj_ext)
    task.set_outputs(out)
    
Task.simple_task_type('gameobjectdesc', 'protoc --encode=GameObject.GameObjectPrototypeDesc -I ../src/gamesys ../src/gamesys/gameobject_ddf.proto < ${SRC} > ${TGT}',
                      color='PINK', 
                      before='cc cxx',
                      shell=True)

@extension('.go_pb')
def testresourcecont_file(self, node):
    obj_ext = '.go'
    task = self.create_task('gameobjectdesc')
    task.set_inputs(node)
    out = node.change_ext(obj_ext)
    task.set_outputs(out)

Task.simple_task_type('pyscript', 'cat < ${SRC} > ${TGT}',
                      color='PINK', 
                      before='cc cxx',
                      shell=True)

@extension('.py')
def testresourcecont_file(self, node):
    obj_ext = '.pyscript'
    task = self.create_task('pyscript')
    task.set_inputs(node)
    out = node.change_ext(obj_ext)
    task.set_outputs(out)

def build(bld):
    resources = bld.new_task_gen(source = 'test.cont_pb')
    
    test_resource = bld.new_task_gen(features = 'cxx cprogram',
                                     includes = '../../../src',
                                     uselib = 'GTEST DLIB DDF',
                                     uselib_local = 'gamesys',
                                     proto_gen_py = True,
                                     target = 'test_resource',
                                     source = 'test_resource.cpp test_resource_ddf.proto test.cont_pb test01.foo_pb test02.foo_pb')

    test_resource.install_path = None

    test_gameobject = bld.new_task_gen(features = 'cxx cprogram',
                                     includes = '../../../src',
                                     uselib = 'GTEST DLIB DDF',
                                     uselib_local = 'gamesys',
                                     proto_gen_py = True,
                                     target = 'test_gameobject',
                                     source = 'test_gameobject.cpp goproto01.go_pb script01.py')

    test_gameobject.install_path = None

    test_script = bld.new_task_gen(features = 'cxx cprogram',
                                     includes = '../../../src',
                                     uselib = 'GTEST DLIB DDF',
                                     uselib_local = 'gamesys',
                                     proto_gen_py = True,
                                     target = 'test_script',
                                     source = 'test_script.cpp')

    test_script.install_path = None
    