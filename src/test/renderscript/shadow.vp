#include "shadow.h"

uniform float4x4 VIEW_PROJ          : (c0);
uniform float4x4 WORLD              : (c4);
uniform float4x4 TEXTURE            : (c8);
uniform float4x4 LIGHT_VIEW_PROJ    : (c12);

void main(in Vertex v_in,
          out Fragment f_out)
{
    float4x4 mvp = mul(WORLD, VIEW_PROJ);

    f_out.position = mul(v_in.position, mvp);
    f_out.world_pos = float3(mul(v_in.position, WORLD));
    f_out.normal = mul(float4(v_in.normal.x, v_in.normal.y, v_in.normal.z, 0.0), WORLD).xyz;
    f_out.uv = v_in.uv;
    float4x4 lmvp = mul(WORLD, LIGHT_VIEW_PROJ);
    f_out.shadow_uv = mul(v_in.position, lmvp);
    f_out.shadow_uv = (f_out.shadow_uv + f_out.shadow_uv.w) * 0.5;
}
