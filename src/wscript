#! /usr/bin/env python

import os, sys
import waf_graphics, waf_dynamo

def set_options(opt):
    pass

def build(bld):
    obj = bld.new_task_gen(features = 'cxx cstaticlib pyembed',
                           includes = ['.'],
                           proto_gen_py = True,
                           target = 'render',
                           install_path='${PREFIX}/lib')
    obj.find_sources_in_dirs('. ../proto model')
    obj.source.append('../proto/render_ddf.proto')

    obj = bld.new_task_gen(features = 'cxx cstaticlib',
                           includes = '.',
                           proto_gen_py = True,
                           target = 'render_debug',
                           install_path='${PREFIX}/lib')
    obj.find_sources_in_dirs('debug')

    bld.install_files('${PREFIX}/include/render', 'fontrenderer.h')
    bld.install_files('${PREFIX}/include/render_debug', 'debug/debugrenderer.h')
    bld.install_files('${PREFIX}/include/render/model', 'model/model.h')
    bld.install_files('${PREFIX}/include/render', 'rendercontext.h')
    bld.install_files('${PREFIX}/include/render', 'material.h')

    bld.install_files('${PREFIX}/bin', 'fontc.py')
    bld.install_files('${PREFIX}/lib/python', 'waf_render.py')

    bld.install_files('${PREFIX}/share/proto', '../proto/render_ddf.proto')

# need to sort out shader include dirs before we can reenable this one
#    test_app = bld.new_task_gen(
#        features = 'cxx cprogram',
#        uselib = 'graphics',
#        uselib_local = 'render',
#        target = 'test_app')
#    test_app.find_sources_in_dirs('test')
#    test_app.install_path = None


def configure(conf):
    waf_dynamo.configure(conf)

    if sys.platform == "darwin":
        platform = "darwin"
    elif sys.platform == "linux2":
        platform = "linux"
    elif sys.platform == "win32":
        platform = "win32"
    else:
        conf.fatal("Unable to determine platform")

    if platform == "darwin":
        conf.env.append_value('LINKFLAGS', ['-framework', 'Cocoa', '-framework', 'OpenGL', '-lSDLmain', '-lSDL'])
    if platform == "linux":
        conf.env.append_value('LINKFLAGS', ['-lglut', '-lXext', '-lX11', '-lXi', '-lGL', '-lGLU', '-lSDL'])
    if platform == "win32":
       conf.env.append_value('LINKFLAGS', ['/SUBSYSTEM:WINDOWS', 'SDL.lib', 'SDLmain.lib', 'opengl32.lib'])

    conf.env.append_value('CPPPATH', ".")
    conf.env.append_value('CXXDEFINES', "DDF_EXPOSE_DESCRIPTORS")
    




